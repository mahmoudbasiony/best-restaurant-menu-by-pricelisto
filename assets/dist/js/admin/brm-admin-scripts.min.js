"use strict";!function(d){var t={listType:"ul",handle:"div",items:"li",toleranceElement:"> div",forcePlaceholderSize:!0,helper:"clone",opacity:.6,placeholder:"placeholder",revert:250,tabSize:25,tolerance:"pointer",maxLevels:3,isTree:!0,protectRoot:!1,expandOnHover:700,startCollapsed:!1,isAllowed:function(e,o,a){return!0},start:function(e,o){console.log("start")},receive:function(e,o){console.log("recieve")},stop:function(e,o){console.log("stop")},change:function(){console.log("Changed item")},relocate:function(e,o){console.log("Relocated item"),c()}};function r(){d("#popup-overlay").length<=0&&d("body").append('<div id="popup-overlay"><div class="popup-overlay-content"><div class="popup-close cancel-group"><svg viewbox="0 0 40 40"><path class="close-x" d="M 10,10 L 30,30 M 30,10 L 10,30" /></svg></div></div></div>')}function c(){var s=1,i=[];d(".group-raw").each(function(){d(this).data("order",s);var e=d(this).data("group-id"),o=d(this).data("order");d(".brm-groups-admin:first").children("li").children(".group-raw").data("parent-id",0),0<d(this).siblings("ul").length&&d(this).siblings("ul").find("div.group-raw").data("parent-id",e);var a=d(this).data("parent-id"),r={};r.group_id=e,r.order=o,r.parent_id=a,i.push(r),s++});var e,o,s=1;d(".item-raw").each(function(e){d(this).data("order",s);var o=d(this).data("item-id"),a=d(this).data("order"),r=d(this).closest("li.brm-group-li").data("group"),t={};t.item_id=o,t.item_order=a,t.group_linked=r,i.push(t),s++}),0<i.length&&(o={sorting_data:e=JSON.stringify(i),action:"brm_order_nesting_groups_items",nonce:brm_params.nonce},console.log(e),d.ajax({url:brm_params.ajax_url,data:o,type:"POST",success:function(e){if(console.log(e),e&&e.data&&e.data.menu){var r=[];d("li.brm-group-li.mjs-nestedSortable-collapsed").each(function(e){var o=d(this).data("group"),a={};a.id=o,r.push(a)}),d(".brm-menu ul.brm-groups-admin:first").replaceWith(e.data.menu),d("ul.brm-groups-admin:first").nestedSortable(t);for(var o=0;o<r.length;o++){var a=r[o].id,a=d('li.brm-group-li[data-group="'+a+'"]');a.toggleClass("mjs-nestedSortable-collapsed").toggleClass("mjs-nestedSortable-expanded"),a.find("span.disclose:first").toggleClass("ui-icon-plusthick").toggleClass("ui-icon-minusthick")}d(".sp-volume").hide()}},error:function(e){console.log(e),d(".sp-volume").hide()}}))}d(".brm-groups-admin:first").nestedSortable(t),d(".expandEditor").attr("title","Click to show/hide group description"),d(".disclose").attr("title","Click to show/hide children"),d(document).on("click",".disclose",function(){d(this).closest("li").toggleClass("mjs-nestedSortable-collapsed").toggleClass("mjs-nestedSortable-expanded"),d(this).toggleClass("ui-icon-plusthick").toggleClass("ui-icon-minusthick")}),d(document).on("click",".expandEditor",function(){var e=d(this).attr("data-id");d("#group-"+e+"-desc").toggle(),d(this).toggleClass("ui-icon-triangle-1-n").toggleClass("ui-icon-triangle-1-s")}),d(document).on("click",".add-new-group-btn",function(e){e.preventDefault(),r();e=brm_params.render_group_form;d("#popup-overlay .popup-overlay-content").html(""),d("#popup-overlay .popup-overlay-content").append('<div class="popup-close cancel-group"><svg viewbox="0 0 40 40"><path class="close-x" d="M 10,10 L 30,30 M 30,10 L 10,30" /></svg></div>'),d("#popup-overlay .popup-overlay-content").append(e),d(".popup-close").on("click",function(e){d("#popup-overlay").remove()})}),d(document).on("click",".edit-group",function(e){e.preventDefault();var o=d(this).closest(".group-raw").data("group-id"),a=d(this).closest(".group-raw").data("order"),e=d(this).closest(".group-raw").data("parent-id"),e=(d(this),{group_id:o,order:a,parent_id:e,action:"brm_edit_group",nonce:brm_params.nonce});d.ajax({url:brm_params.ajax_url,data:e,type:"POST",success:function(e){var o;console.log(e),e&&e.data&&(r(),o=e.data.form,d("#popup-overlay .popup-overlay-content").html(""),d("#popup-overlay .popup-overlay-content").append('<div class="popup-close cancel-group"><svg viewbox="0 0 40 40"><path class="close-x" d="M 10,10 L 30,30 M 30,10 L 10,30" /></svg></div>'),d("#popup-overlay .popup-overlay-content").append(o),console.log(e.data.form))},error:function(e){console.log(e)}})}),d(document).on("click",".save-group",function(e){e.preventDefault();var r=d(this).closest("form.brm-group-form").data("group-id"),o=d(".groups-name").val(),a=d(".groups-description").val(),t=d(".brm-group-raw").data("parent-id"),e=d(".brm-group-raw").data("order");d(".brm-errors").remove(),""===o||null==o||o.length<=0?d(".groups-name").closest("td").prepend('<p class="brm-errors">This field is a required field!</p>'):(e={group_id:r,group_name:o,group_desc:a,parent_id:t,order:e,action:"brm_save_group",nonce:brm_params.nonce},console.log(e),d.ajax({url:brm_params.ajax_url,data:e,type:"POST",beforeSend:function(e){d(".sp-volume").show()},success:function(e){var o,a;console.log(e),e&&e.data&&e.data.status&&("created"==e.data.status||"updated"==e.data.status)&&(o=e.data.group_id,a=e.data.group_raw,d("form.brm-group-form").attr("data-group-id",o),d("#popup-overlay").remove(),0<d('.group-raw[data-group-id="'+o+'"]').length?d('.group-raw[data-group-id="'+o+'"]').replaceWith(a):0<t?0<d('.group-raw[data-group-id="'+t+'"]').closest("li").children("ul.brm-groups-admin").length?d('.group-raw[data-group-id="'+t+'"]').closest("li").children("ul.brm-groups-admin").append('<li class="brm-group-li" data-group="'+r+'">'+a+"<li>"):d('.group-raw[data-group-id="'+t+'"]').closest("li").append('<ul class="brm-groups-admin"><li class="brm-group-li" data-group="'+r+'">'+a+"</li></ul>"):0<d(".brm-menu").children("ul.brm-groups-admin").length?d(".brm-menu").children("ul.brm-groups-admin").append('<li class="brm-group-li" data-group="'+r+'">'+a+"</li>"):d(".brm-menu").append('<ul class="brm-groups-admin"><li class="brm-group-li" data-group="'+r+'">'+a+"</li></ul>"),c()),!e.success&&e.data&&"error"==e.data.status&&(d(".brm-errors").remove(),d(".sp-volume").hide(),e=e.data.message,d(".groups-name").closest("td").prepend('<p class="brm-errors">'+e+"</p>"))},error:function(e){d(".sp-volume").hide()}}))}),d(document).on("click",".delete-group",function(e){e.preventDefault(),confirm("Are you sure to delete this item ?")&&(e={group_id:d(this).closest(".group-raw").data("group-id"),action:"brm_delete_group",nonce:brm_params.nonce},d.ajax({url:brm_params.ajax_url,data:e,type:"POST",beforeSend:function(e){d(".sp-volume").show()},success:function(e){console.log(e),e&&e.data&&e.data.status&&(e=e.data.group_id,console.log(e),d('.brm-group-li[data-group="'+e+'"]').remove(),c(),d(".sp-volume").hide())},error:function(e){console.log(e),d(".sp-volume").hide()}}))}),d(document).on("click",".cancel-group",function(e){e.preventDefault(),d("#popup-overlay").remove(),d(".sp-volume").hide()}),d(document).on("click",".add-new-subgroup",function(e){e.preventDefault();var o=d(this).closest("#add-new-subgroup").data("group-id");console.log(o),console.log(brm_params.render_group_form),r();e=brm_params.render_group_form;d("#popup-overlay .popup-overlay-content").html(""),d("#popup-overlay .popup-overlay-content").append('<div class="popup-close cancel-group"><svg viewbox="0 0 40 40"><path class="close-x" d="M 10,10 L 30,30 M 30,10 L 10,30" /></svg></div>'),d("#popup-overlay .popup-overlay-content").append(e),d(".brm-group-raw").attr("data-parent-id",o),d(".popup-close").on("click",function(e){d("#popup-overlay").remove()})}),d(document).on("click",".add-new-item",function(e){e.preventDefault();var o=d(this).closest("#add-new-item").data("group-id");console.log(o),r();e=brm_params.render_item_form;d("#popup-overlay .popup-overlay-content").html(""),d("#popup-overlay .popup-overlay-content").append('<div class="popup-close cancel-group"><svg viewbox="0 0 40 40"><path class="close-x" d="M 10,10 L 30,30 M 30,10 L 10,30" /></svg></div>'),d("#popup-overlay .popup-overlay-content").append(e),d(".brm-item-raw").attr("data-group-id",o),d(".popup-close").on("click",function(e){d("#popup-overlay").remove()})}),d(document).on("click",".save-item",function(e){e.preventDefault();var r=d(this).closest("form.brm-item-form"),o=r.data("item-id"),a=r.find(".item-name").val(),t=r.find(".item-description").val(),s=r.find("#item-image").val(),i=r.find(".item-price").val(),n=r.find(".brm-item-raw").data("group-id"),p=r.find(".brm-item-raw").data("order");d(".brm-errors").remove();var l,e=!1;(""===a||null==a||a.length<=0)&&(l="This field is a required field!",r.find(".item-name").closest("td").prepend('<p class="brm-errors">'+l+"</p>"),e=!0),0<i.length&&!d.isNumeric(i)&&(l="This field only accepts a numeric value!",r.find(".item-price").closest("td").prepend('<p class="brm-errors">'+l+"</p>"),e=!0),e||(p={item_id:o,item_name:a,item_desc:t,image_id:s,price:i,order:p,group_id:n,action:"brm_save_item",nonce:brm_params.nonce},console.log(p),d.ajax({type:"POST",url:brm_params.ajax_url,data:p,beforeSend:function(e){d(".sp-volume").show()},success:function(e){var o,a;console.log(e),e&&e.data&&e.data.status&&("created"===e.data.status||"updated"===e.data.status)&&(o=e.data.item_id,a=e.data.item_raw,d("form.brm-item-form").attr("data-item-id",o),d("#popup-overlay").remove(),0<d('.item-raw[data-item-id="'+o+'"]').length?d('.item-raw[data-item-id="'+o+'"]').replaceWith(a):0<d('.group-raw[data-group-id="'+n+'"]').closest("li").children("ul.brm-items-admin").length?d('.group-raw[data-group-id="'+n+'"]').closest("li").children("ul.brm-items-admin").append('<li class="mjs-nestedSortable-no-nesting">'+a+"</li>"):d('.group-raw[data-group-id="'+n+'"]').after('<ul class="brm-items-admin"><li class="mjs-nestedSortable-no-nesting">'+a+"</li></ul>"),c()),!e.success&&e.data&&"error"==e.data.status&&(d(".brm-errors").remove(),d(".sp-volume").hide(),a=e.data.class,e=e.data.message,r.find("."+a).closest("td").prepend('<p class="brm-errors">'+e+"</p>"))},error:function(e){console.log(e)}}))}),d(document).on("click",".edit-item",function(e){e.preventDefault();e={item_id:d(this).closest(".item-raw").data("item-id"),order:d(this).closest(".item-raw").data("order"),group_id:d(this).closest(".item-raw").data("group-id"),action:"brm_edit_item",nonce:brm_params.nonce};console.log(e),d.ajax({url:brm_params.ajax_url,data:e,type:"POST",success:function(e){var o;console.log(e),e&&e.data&&(r(),o=e.data.form,d("#popup-overlay .popup-overlay-content").html(""),d("#popup-overlay .popup-overlay-content").append('<div class="popup-close cancel-group"><svg viewbox="0 0 40 40"><path class="close-x" d="M 10,10 L 30,30 M 30,10 L 10,30" /></svg></div>'),d("#popup-overlay .popup-overlay-content").append(o),console.log(e.data.form))},error:function(e){console.log(e)}})}),d(document).on("click",".cancel-item",function(e){e.preventDefault(),d("#popup-overlay").remove(),d(".sp-volume").hide()}),d(document).on("click",".delete-item",function(e){e.preventDefault(),confirm("Are you sure to delete this item ?")&&(e={item_id:d(this).closest(".item-raw").data("item-id"),action:"brm_delete_item",nonce:brm_params.nonce},d.ajax({url:brm_params.ajax_url,data:e,type:"POST",beforeSend:function(e){d(".sp-volume").show()},success:function(e){console.log(e),e&&e.data&&e.data.status&&(e=e.data.item_id,d('.item-raw[data-item-id="'+e+'"]').remove(),c())},error:function(e){console.log(e),d(".sp-volume").hide()}}))}),d(document).on("click",".upload_image_button",function(e){e.preventDefault();var o=d(this),a=wp.media({title:"Insert image",library:{type:"image"},button:{text:"Insert into item"},multiple:!1}).on("select",function(){var e=a.state().get("selection").first().toJSON();d(o).parent().removeClass("no-image"),d(o).parent().prev().attr("src",e.url).show(),d(o).prev().val(e.id),d(o).next().show()}).open()}),d(document).on("click",".remove_image_button",function(){var e;return 1==confirm("Are you sure?")&&(e=d(this).parent().prev().attr("data-src"),d(this).parent().addClass("no-image"),d(this).parent().prev().attr("src",e).hide(),d(this).prev().prev().val(""),d(this).hide()),!1}),d("#business_country, #business_currency, #theme-template").select2()}(jQuery);