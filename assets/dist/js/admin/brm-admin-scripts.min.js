"use strict";!function(c){var l={listType:"ul",handle:"div",items:"li",toleranceElement:"> div",forcePlaceholderSize:!0,helper:"clone",opacity:.6,placeholder:"placeholder",revert:250,tabSize:25,tolerance:"pointer",maxLevels:3,isTree:!0,protectRoot:!1,expandOnHover:700,startCollapsed:!1,isAllowed:function(){return!0},start:function(){console.log("start")},receive:function(){console.log("recieve")},stop:function(){console.log("stop")},change:function(){console.log("Changed item")},relocate:function(){console.log("Relocated item"),m()}};function i(){c("#popup-overlay").length<=0&&c("body").append('<div id="popup-overlay"><div class="popup-overlay-content"><div class="popup-close cancel-group"><svg viewbox="0 0 40 40"><path class="close-x" d="M 10,10 L 30,30 M 30,10 L 10,30" /></svg></div></div></div>')}function m(){var i=1,s=[];c(".group-raw").each(function(){c(this).data("order",i);var e=c(this).data("group-id"),o=c(this).data("order");c(".brm-groups-admin:first").children("li").children(".group-raw").data("parent-id",0),0<c(this).siblings("ul").length&&c(this).siblings("ul").find("div.group-raw").data("parent-id",e);var a=c(this).data("parent-id"),r={};r.group_id=e,r.order=o,r.parent_id=a,s.push(r),i++});i=1;if(c(".item-raw").each(function(e){c(this).data("order",i);var o=c(this).data("item-id"),a=c(this).data("order"),r=c(this).closest("li.brm-group-li").data("group"),t={};t.item_id=o,t.item_order=a,t.group_linked=r,s.push(t),i++}),0<s.length){var e=JSON.stringify(s),o={sorting_data:e,action:"brm_order_nesting_groups_items"};console.log(e),c.ajax({url:brm_params.ajax_url,data:o,type:"POST",success:function(e){if(console.log(e),e&&e.data&&e.data.menu){var r=[];c("li.brm-group-li.mjs-nestedSortable-collapsed").each(function(e){var o=c(this).data("group"),a={};a.id=o,r.push(a)}),c(".brm-menu ul.brm-groups-admin:first").replaceWith(e.data.menu),c("ul.brm-groups-admin:first").nestedSortable(l);for(var o=0;o<r.length;o++){var a=r[o].id,t=c('li.brm-group-li[data-group="'+a+'"]');t.toggleClass("mjs-nestedSortable-collapsed").toggleClass("mjs-nestedSortable-expanded"),t.find("span.disclose:first").toggleClass("ui-icon-plusthick").toggleClass("ui-icon-minusthick")}c(".sp-volume").hide()}},error:function(e){console.log(e),c(".sp-volume").hide()}})}}c(".brm-groups-admin:first").nestedSortable(l),c(".expandEditor").attr("title","Click to show/hide group description"),c(".disclose").attr("title","Click to show/hide children"),c(document).on("click",".disclose",function(){c(this).closest("li").toggleClass("mjs-nestedSortable-collapsed").toggleClass("mjs-nestedSortable-expanded"),c(this).toggleClass("ui-icon-plusthick").toggleClass("ui-icon-minusthick")}),c(document).on("click",".expandEditor",function(){var e=c(this).attr("data-id");c("#group-"+e+"-desc").toggle(),c(this).toggleClass("ui-icon-triangle-1-n").toggleClass("ui-icon-triangle-1-s")}),c(document).on("click",".add-new-group-btn",function(e){e.preventDefault(),i();var o=brm_params.render_group_form;c("#popup-overlay .popup-overlay-content").html(""),c("#popup-overlay .popup-overlay-content").append('<div class="popup-close cancel-group"><svg viewbox="0 0 40 40"><path class="close-x" d="M 10,10 L 30,30 M 30,10 L 10,30" /></svg></div>'),c("#popup-overlay .popup-overlay-content").append(o),c(".popup-close").on("click",function(e){c("#popup-overlay").remove()})}),c(document).on("click",".edit-group",function(e){e.preventDefault();var o=c(this).closest(".group-raw").data("group-id"),a=c(this).closest(".group-raw").data("order"),r=c(this).closest(".group-raw").data("parent-id"),t=(c(this),{group_id:o,order:a,parent_id:r,action:"brm_edit_group"});c.ajax({url:brm_params.ajax_url,data:t,type:"POST",success:function(e){if(console.log(e),e&&e.data){i();var o=e.data.form;c("#popup-overlay .popup-overlay-content").html(""),c("#popup-overlay .popup-overlay-content").append('<div class="popup-close cancel-group"><svg viewbox="0 0 40 40"><path class="close-x" d="M 10,10 L 30,30 M 30,10 L 10,30" /></svg></div>'),c("#popup-overlay .popup-overlay-content").append(o),console.log(e.data.form)}},error:function(e){console.log(e)}})}),c(document).on("click",".save-group",function(e){e.preventDefault();var t=c(this).closest("form.brm-group-form").data("group-id"),o=c(".groups-name").val(),a=c(".groups-description").val(),i=c(".brm-group-raw").data("parent-id"),r=c(".brm-group-raw").data("order");if(c(".brm-errors").remove(),""===o||null==o||o.length<=0){c(".groups-name").closest("td").prepend('<p class="brm-errors">This field is a required field!</p>')}else{var s={group_id:t,group_name:o,group_desc:a,parent_id:i,order:r,action:"brm_save_group"};console.log(s),c.ajax({url:brm_params.ajax_url,data:s,type:"POST",beforeSend:function(){c(".sp-volume").show()},success:function(e){if(console.log(e),e&&e.data&&e.data.status&&("created"==e.data.status||"updated"==e.data.status)){var o=e.data.group_id,a=e.data.group_raw;c("form.brm-group-form").attr("data-group-id",o),c("#popup-overlay").remove(),0<c('.group-raw[data-group-id="'+o+'"]').length?c('.group-raw[data-group-id="'+o+'"]').replaceWith(a):0<i?0<c('.group-raw[data-group-id="'+i+'"]').closest("li").children("ul.brm-groups-admin").length?c('.group-raw[data-group-id="'+i+'"]').closest("li").children("ul.brm-groups-admin").append('<li class="brm-group-li" data-group="'+t+'">'+a+"<li>"):c('.group-raw[data-group-id="'+i+'"]').closest("li").append('<ul class="brm-groups-admin"><li class="brm-group-li" data-group="'+t+'">'+a+"</li></ul>"):0<c(".brm-menu").children("ul.brm-groups-admin").length?c(".brm-menu").children("ul.brm-groups-admin").append('<li class="brm-group-li" data-group="'+t+'">'+a+"</li>"):c(".brm-menu").append('<ul class="brm-groups-admin"><li class="brm-group-li" data-group="'+t+'">'+a+"</li></ul>"),m()}if(!e.success&&e.data&&"error"==e.data.status){c(".brm-errors").remove(),c(".sp-volume").hide();var r=e.data.message;c(".groups-name").closest("td").prepend('<p class="brm-errors">'+r+"</p>")}},error:function(){c(".sp-volume").hide()}})}}),c(document).on("click",".delete-group",function(e){if(e.preventDefault(),confirm("Are you sure to delete this item ?")){var o={group_id:c(this).closest(".group-raw").data("group-id"),action:"brm_delete_group"};c.ajax({url:brm_params.ajax_url,data:o,type:"POST",beforeSend:function(){c(".sp-volume").show()},success:function(e){if(console.log(e),e&&e.data&&e.data.status){var o=e.data.group_id;console.log(o),c('.brm-group-li[data-group="'+o+'"]').remove(),m(),c(".sp-volume").hide()}},error:function(e){console.log(e),c(".sp-volume").hide()}})}}),c(document).on("click",".cancel-group",function(e){e.preventDefault(),c("#popup-overlay").remove(),c(".sp-volume").hide()}),c(document).on("click",".add-new-subgroup",function(e){e.preventDefault();var o=c(this).closest("#add-new-subgroup").data("group-id");console.log(o),console.log(brm_params.render_group_form),i();var a=brm_params.render_group_form;c("#popup-overlay .popup-overlay-content").html(""),c("#popup-overlay .popup-overlay-content").append('<div class="popup-close cancel-group"><svg viewbox="0 0 40 40"><path class="close-x" d="M 10,10 L 30,30 M 30,10 L 10,30" /></svg></div>'),c("#popup-overlay .popup-overlay-content").append(a),c(".brm-group-raw").attr("data-parent-id",o),c(".popup-close").on("click",function(e){c("#popup-overlay").remove()})}),c(document).on("click",".add-new-item",function(e){e.preventDefault();var o=c(this).closest("#add-new-item").data("group-id");console.log(o),i();var a=brm_params.render_item_form;c("#popup-overlay .popup-overlay-content").html(""),c("#popup-overlay .popup-overlay-content").append('<div class="popup-close cancel-group"><svg viewbox="0 0 40 40"><path class="close-x" d="M 10,10 L 30,30 M 30,10 L 10,30" /></svg></div>'),c("#popup-overlay .popup-overlay-content").append(a),c(".brm-item-raw").attr("data-group-id",o),c(".popup-close").on("click",function(e){c("#popup-overlay").remove()})}),c(document).on("click",".save-item",function(e){e.preventDefault();var i=c(this).closest("form.brm-item-form"),o=i.data("item-id"),a=i.find(".item-name").val(),r=i.find(".item-description").val(),t=i.find("#item-image").val(),s=i.find(".item-price").val(),l=i.find(".brm-item-raw").data("group-id"),p=i.find(".brm-item-raw").data("order");c(".brm-errors").remove();var n=!1;if(""===a||null==a||a.length<=0){var d="This field is a required field!";i.find(".item-name").closest("td").prepend('<p class="brm-errors">'+d+"</p>"),n=!0}if(0<s.length&&!c.isNumeric(s)){d="This field only accepts a numeric value!";i.find(".item-price").closest("td").prepend('<p class="brm-errors">'+d+"</p>"),n=!0}if(!n){var u={item_id:o,item_name:a,item_desc:r,image_id:t,price:s,order:p,group_id:l,action:"brm_save_item"};console.log(u),c.ajax({type:"POST",url:brm_params.ajax_url,data:u,beforeSend:function(){c(".sp-volume").show()},success:function(e){if(console.log(e),e&&e.data&&e.data.status&&("created"===e.data.status||"updated"===e.data.status)){var o=e.data.item_id,a=e.data.item_raw;c("form.brm-item-form").attr("data-item-id",o),c("#popup-overlay").remove(),0<c('.item-raw[data-item-id="'+o+'"]').length?c('.item-raw[data-item-id="'+o+'"]').replaceWith(a):0<c('.group-raw[data-group-id="'+l+'"]').closest("li").children("ul.brm-items-admin").length?c('.group-raw[data-group-id="'+l+'"]').closest("li").children("ul.brm-items-admin").append('<li class="mjs-nestedSortable-no-nesting">'+a+"</li>"):c('.group-raw[data-group-id="'+l+'"]').after('<ul class="brm-items-admin"><li class="mjs-nestedSortable-no-nesting">'+a+"</li></ul>"),m()}if(!e.success&&e.data&&"error"==e.data.status){c(".brm-errors").remove(),c(".sp-volume").hide();var r=e.data.class,t=e.data.message;i.find("."+r).closest("td").prepend('<p class="brm-errors">'+t+"</p>")}},error:function(e){console.log(e)}})}}),c(document).on("click",".edit-item",function(e){e.preventDefault();var o={item_id:c(this).closest(".item-raw").data("item-id"),order:c(this).closest(".item-raw").data("order"),group_id:c(this).closest(".item-raw").data("group-id"),action:"brm_edit_item"};console.log(o),c.ajax({url:brm_params.ajax_url,data:o,type:"POST",success:function(e){if(console.log(e),e&&e.data){i();var o=e.data.form;c("#popup-overlay .popup-overlay-content").html(""),c("#popup-overlay .popup-overlay-content").append('<div class="popup-close cancel-group"><svg viewbox="0 0 40 40"><path class="close-x" d="M 10,10 L 30,30 M 30,10 L 10,30" /></svg></div>'),c("#popup-overlay .popup-overlay-content").append(o),console.log(e.data.form)}},error:function(e){console.log(e)}})}),c(document).on("click",".cancel-item",function(e){e.preventDefault(),c("#popup-overlay").remove(),c(".sp-volume").hide()}),c(document).on("click",".delete-item",function(e){if(e.preventDefault(),confirm("Are you sure to delete this item ?")){var o={item_id:c(this).closest(".item-raw").data("item-id"),action:"brm_delete_item"};c.ajax({url:brm_params.ajax_url,data:o,type:"POST",beforeSend:function(){c(".sp-volume").show()},success:function(e){if(console.log(e),e&&e.data&&e.data.status){var o=e.data.item_id;c('.item-raw[data-item-id="'+o+'"]').remove(),m()}},error:function(e){console.log(e),c(".sp-volume").hide()}})}}),c(document).on("click",".upload_image_button",function(e){e.preventDefault();var o=c(this),a=wp.media({title:"Insert image",library:{type:"image"},button:{text:"Insert into item"},multiple:!1}).on("select",function(){var e=a.state().get("selection").first().toJSON();c(o).parent().removeClass("no-image"),c(o).parent().prev().attr("src",e.url).show(),c(o).prev().val(e.id),c(o).next().show()}).open()}),c(document).on("click",".remove_image_button",function(){if(1==confirm("Are you sure?")){var e=c(this).parent().prev().attr("data-src");c(this).parent().addClass("no-image"),c(this).parent().prev().attr("src",e).hide(),c(this).prev().prev().val(""),c(this).hide()}return!1}),c("#business_country, #business_currency, #theme-template").select2()}(jQuery);